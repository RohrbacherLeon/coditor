{% extends "layouts/master.twig" %}

{% block assets %}
    <link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" href="/js/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="/js/codemirror/addon/hint/show-hint.css">
    <link rel="stylesheet" href="/js/codemirror/theme/ambiance.css">

    <script src="/js/codemirror/lib/codemirror.js"></script>
    <script src="/js/codemirror/mode/javascript/javascript.js"></script>

    <script src="/js/codemirror/addon/hint/show-hint.js"></script>
    <script src="/js/codemirror/addon/hint/javascript-hint.js"></script>

{% endblock %}

{% block content %}

{% include './partials/popup_correction.twig' %}

<div class="exercise__opened">
    <form class="exercise__opened__top" method='post'>
        <div class="exercise__opened__top__subject">
            <h1>{{ exercise.title }}</h1>
            <div class="description">
                {{ markdown }}
            </div>
            <div class="waitings">
                {% for title in exercise.awaited.titles %}
                    <div class="waiting {{ title in results ? 'success' : 'error' }}">
                        {% if title in results %}
                            <i class="far fa-check-circle"></i>
                        {% else %}
                            <i class="far fa-times-circle"></i>
                        {% endif %}
                        {{title}}
                    </div>
                {% endfor %}
            </div>
        </div>
            {# If skeleton exist, print it #}
        {% if skeletonText %} <textarea name="function" id="js-textarea" cols="30" rows="10">{{skeletonText}}</textarea>
        {% else %}<textarea name="function" id="js-textarea" cols="30" rows="10">{{content.fct}}</textarea>
        {% endif %}
        </div>
        <div class="exercise__opened__bottom">
            <div id="openCorrection" class="button button--green">Afficher la correction</div>
            <button type='submit' class="button button--green">Valider le code</button>
            {% if setParams.next %}
                <a href="../{{ setParams.next.language }}/{{ setParams.next.slug }}" class="button button--green">Exercice suivant</a>
            {% elseif setParams.setslug %}
                <a href="/sets/{{ setParams.setslug }}" class="button button--green">Terminer s√©rie</a>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}

        

{% block scripts %}

        
    <script>
        let editor = CodeMirror.fromTextArea(document.getElementById('js-textarea'), {
            value: "",
            lineNumbers: true,
            mode:  "javascript",
            theme: 'ambiance',
            extraKeys: {"Ctrl-Space": "autocomplete"},
        });
    </script>

    <script>
            // Get the popup
            let popup = document.getElementById('popupCorrection');

            // Get the button that opens the popup
            let btn = document.getElementById("openCorrection");

            // Get the <span> element that closes the popup
            let span = document.getElementsByClassName("close")[0];

            // When the user clicks on the button, open the popup 
            btn.onclick = function() {
                popup.style.display = "block";
                editorCorrection.refresh()
            }

            // When the user clicks on <span> (x), close the popup
            span.onclick = function() {
                popup.style.display = "none";
            }

            // When the user clicks anywhere outside of the popup, close it
            window.onclick = function(event) {
                if (event.target == popup) {
                    popup.style.display = "none";
                }
            }

            $('#js-dropdown-head').click(function(){
                $('#js-dropdown').toggleClass('open')
            })
    </script>
{% endblock %}
